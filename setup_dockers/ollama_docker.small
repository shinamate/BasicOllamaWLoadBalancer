#!/bin/bash
PORT=19330
docker run -it --rm --name ollama_server_small_01 --hostname ollama_server_small_01 --gpus all -u 1000:1000 -e "OLLAMA_HOST=172.18.0.3:$PORT" -e "OLLAMA_MODELS=/workspace/model_ollama_small" -e "OLLAMA_NUM_PARALLEL=6" -e "OLLAMA_MAX_LOADED_MODELS=3" -m 60G --shm-size 60G -v /home/$(id -un)/Documents/ollama_server_mounted:/workspace --net ollama_server_br ollama_server:base bash

tmux new-session -d -s ollama_server_small
echo "docker start ollama_server_small_01" > run.sh
chmod u+x ./run.sh
tmux new-window -t ollama_server_small:1
tmux send-keys -t ollama_server_small:1 ./run.sh Enter

sleep 5s

echo 'docker exec -it -u 1000:1000 ollama_server_small_01 bash -ic "ollama serve"' > ./run.sh
chmod u+x ./run.sh
tmux new-window -t ollama_server_small:2
tmux send-keys -t ollama_server_small:2 ./run.sh Enter
sleep 10s

echo 'docker exec -it -u 1000:1000 ollama_server_small_01 bash -ic "ollama run qwen3:1.7b --keepalive=24h"' > ./run.sh
chmod u+x ./run.sh
tmux new-window -t ollama_server_small:3
tmux send-keys -t ollama_server_small:3 ./run.sh Enter
sleep 10s

#echo 'docker exec -it -u 1000:1000 ollama_server_small_01 bash -ic "ollama run qwen2.5vl:3b --keepalive=24h"' > ./run.sh
#chmod u+x ./run.sh
#tmux new-window -t ollama_server_small:4
#tmux send-keys -t ollama_server_small:4 ./run.sh Enter
#sleep 10s
#
#echo 'docker exec -it -u 1000:1000 ollama_server_small_01 bash -ic "ollama run llama3.2:1b --keepalive=24h"' > ./run.sh
#chmod u+x ./run.sh
#tmux new-window -t ollama_server_small:5
#tmux send-keys -t ollama_server_small:5 ./run.sh Enter
#sleep 10s
#
#echo 'docker exec -it -u 1000:1000 ollama_server_small_01 bash -ic "ollama run llama3.2:3b --keepalive=24h"' > ./run.sh
#chmod u+x ./run.sh
#tmux new-window -t ollama_server_small:6
#tmux send-keys -t ollama_server_small:6 ./run.sh Enter
#sleep 10s
#
#echo 'docker exec -it -u 1000:1000 ollama_server_small_01 bash -ic "ollama run ollama_server3:3b --keepalive=24h"' > ./run.sh
#chmod u+x ./run.sh
#tmux new-window -t ollama_server_small:7
#tmux send-keys -t ollama_server_small:7 ./run.sh Enter
#sleep 10s
#
#echo 'docker exec -it -u 1000:1000 ollama_server_small_01 bash -ic "ollama run deepseek-r1:1.5b --keepalive=24h"' > ./run.sh
#chmod u+x ./run.sh
#tmux new-window -t ollama_server_small:8
#tmux send-keys -t ollama_server_small:8 ./run.sh Enter
#sleep 10s

#echo 'docker exec -it -u 1000:1000 ollama_server_small_01 bash -ic "ollama pull bge-m3:567m"' > ./run.sh
#chmod u+x ./run.sh
#tmux send-keys -t ollama_server_small:1 ./run.sh Enter
#sleep 1s
#
#echo 'docker exec -it -u 1000:1000 ollama_server_small_01 bash -ic "ollama pull bge-medium:335m"' > ./run.sh
#chmod u+x ./run.sh
#tmux send-keys -t ollama_server_small:1 ./run.sh Enter
#sleep 1s
#
#echo 'docker exec -it -u 1000:1000 ollama_server_small_01 bash -ic "ollama pull nomic-embed-text"' > ./run.sh
#chmod u+x ./run.sh
#tmux send-keys -t ollama_server_small:1 ./run.sh Enter
#sleep 1s
#
#echo 'docker exec -it -u 1000:1000 ollama_server_small_01 bash -ic "ollama pull snowflake-arctic-embed2:568m"' > ./run.sh
#chmod u+x ./run.sh
#tmux send-keys -t ollama_server_small:1 ./run.sh Enter

rm ./run.sh
